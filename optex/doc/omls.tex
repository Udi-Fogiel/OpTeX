\fontfam[lm]
\adef<#1>{{\Blue$\langle$\hbox{\it#1\/}$\rangle$}}
\everyintt={\catcode`<=13 \Red}
\verbchar`
\enlang
\enquotes
\def\r[#1]{\label[#1]\wlabel{\the\_itemnum}}
\def\:{$\to$}
\let\_narrowlastlinecentered=\ignoreit
\_def\_printsecc#1{\_par
   \_abovetitle{\_penalty-200}{\_medskip\_smallskip}
   {\_seccfont \_noindent \_raggedright \_printrefnum[@\_quad]%
       \_label[\the\_secnum.\the\_seccnum]\_wlabel{\the\_secnum.\the\_seccnum}#1\_nbpar}%
   \_nobreak \_belowtitle{\_medskip}%
   \_firstnoindent
}
\def\.`{\bgroup\catcode`\ =12 \scancs}
\def\scancs#1{\egroup
   \immediate\_wref\Xknowncs{\string#1{\the\_secnum.\the\_seccnum}}%
   \ea`\string#1%
}
\def\printcs#1{\ea\printcsred\csstring#1;~\ref[#1] \ }
\def\printcsred,#1;{{\Red\tt \bslash#1}}
\def\printknowncs{\ifx\knowncslist\empty TeX me again...\else
   \_dosorting\knowncslist \ea\xargs \ea\printcs \knowncslist;\fi}

\refdecl{
  \def\knowncslist{}^^J
  \def\Xknowncs#1#2{%
     \sxdef{,\csstring#1}{#2}%
     \global\ea\addto\ea\knowncslist\ea{\csname,\csstring#1\endcsname}%
  }
}
\sdef{_item:c}{\pdfsave\llap{\pdfscale{1.3}{1.3}$\circ$\enspace}\pdfrestore}

%\parindent=15pt \iindent=\parindent \ttindent=\parindent
%\ttindent=0pt
\everylist={\advance\ttindent by-1em}
\hyperlinks \Green \Green
\def\cskip{\par\nobreak}
\def\begblock{\medskip\hbox\bgroup\vrule\vbox\bgroup\hrule\smallskip
   \_fnset\leftskip=\parindent \rightskip=\parindent \medskip\noindent}
\def\endblock{\medskip\hrule\egroup\vrule\egroup}

\titskip=1cm

\tit \OpTeX/ Markup Language Standard

{\it\hfil Petr Olšák, 2021}\bigskip

The \OpTeX/ markup language standard (OMLS) declares a list of control
sequences used in \OpTeX/ documents including their syntax and sematic. The
listed control sequences in OMLS in section~\ref[listcs]
are called {\it known} and other control sequences are {\it unknown}.

The main reason for OMLS is to give instructions on how to program convertors
from \OpTeX/ documents to another formats (Html, Markdown, \LaTeX/) or how
to interpret the \OpTeX/ document sources in such applications as
{\tt texcount} or color highlighting in editors\fnote
{Or advanced editor features: sections/chapters folding,
 auto-completions, etc.}.
These converters and applications are called {\it cnv-programs} in this document.

We suppose that if you need absolute control over the typography of the
document when it is converted to PDF pages, then you use \OpTeX/ itself. If
you need to create other formats of the same document then you can use a
cnv-program which accepts OMLS. The result is a document without
typographical instructions like dimensions of pages, margins, paginations
and headers, selection of a font-family, dimensions of the fonts, etc.\ You can
imagine the result of such a conversion as one Html page where more
typographical features can be controlled in a different way, for example by
an external CSS file. This is a reason why control sequences like `\fontfam` or
`\margins` are ignored by cnv-programs.

Obviously, \TeX/ and \OpTeX/ itself gives possibility to declare various
input formats for various purposes. Sometimes (in very special cases) there
exists a good reason to declare a different and special input format by
\TeX/ macros. But if the source of the document respects the OMLS then it is
reasonably transformable to other formats by cnv-programs. We hope that
OMLS-ready documents cover a very large set of typical documents used these
days.

We suppose that cnv-programs work internally with strings of source lines
without tokenization. This is one of the great difference in processing the
document directly by \OpTeX/ and using a cnv-program. The second difference is
that the expansion process of macros is not implemented in cnv-programs in
its full range. We respect that the result of cnv-programs will be different
than from processing directly by \OpTeX/. But this is not a bug, this is
the feature. We concentrate on the fixed syntax and sematic given by OMLS of the
\OpTeX/ document and we throw behind the head the typographical
exactness of the document which can be done only directly by \TeX/ (and it is
exactly described in \TeX/book, for example).

\notoc\nonum\sec Contents

\maketoc
\vfil\break

\sec Syntactical rules

The syntactical elements are described as strings here. No \TeX/'s tokenization is
taken into account. The rule with a smaller number has precedence.

\begitems \style n
* end of line or end of file \: `<eol>`.\r[eol]
* `%%:` at beginning of the line \: <cnv-declarator>, see section~\ref[cnv-decl].
* `<cnv-declarator><text><eol>` is interpreted specially.
* space or a tab-character \: `<space>`.
* non-empty sequence of `<space>`s \: `<spaces>`.
* a line only with `<spaces>` \: `<empty-line>`.\r[spcs]
* a character `a`--`z` or `A`--`Z` \: `<letter>`.
* a  `<letter>` or `_` \: `<specletter>`.
* a character different from previous rule or `<eol>` or `<spaces>` \: `<non-spec-letter>`
* `\<non-specletter>` \: `<singlechar-control-sequence>`.\r[scs]
* a non-empty sequence of `<specletter>`s \: `<letters-seq>`.
* `\<letters-seq><non-specletter>` \: `<multiletter-control-sequence><non-specletter>`.
* `%<text><eol>` \: `<comment>` and it is completely ignored including `<eol>`.\r[com]
* `<spaces>` at beginning of the line marks that the line as {\it indented}.
* `<spaces>` at beginning of the line \: are ignored.\r[bspace]
* `<spaces><eol>` or `<eol>` \: `<space>`.\r[eolrm]
* `<multileter-control-sequence><spaces>` \: `<multileter-control-sequence>`.\r[csspace]
* `<multiletter-control-sequence>` or `<singlechar-control-sequence>` \: `<control-sequence>`.\r[cs]
* `<spaces>` \: `<space>`.\r[sspace]
* `~` \: non-breakable space.
* text where all pairs `{` and `}` match at arbitrary level \: `<balanced text>`.\r[balt]
* `{<balanced text>}` can be interpreted as a parameter followed by a <control-sequence>, see section~\ref[listcs].
* The `{` alone not used by previous rule opens a group and the `}` alone closes the same group.\r[group]
* There are two main modes: h-mode, v-mode\fnote
  {this is great simplification of real \TeX/ modes.}.
  The document processing starts in v-mode.
* In v-mode: a single `<non-space>` character or control sequences listed
  in table~\ref[vtohmode] swithes to h-mode.
* In h-mode: an empty line or control sequences listed in table~\ref[htovmode] switches to v-mode.\r[htov]
* The switching from v-mode to h-mode \: a paragraph begins.
* The switching from h-mode to v-mode \: the current paragraph ends.
* `$<text>$` or `$$<text>$$` \: process `<text>` in math-mode, see section~\ref[math].
* a non-empty sequence of digits with optional `+` or `-` in the front \: `<number>`.
* `<number>` with optional dot inside the sequence of digits \: `<decimal-number>`.
* a pair of letters listed in the table~\ref[tex-units] \: `<tex-unit>`.
* optional space, i.e.\ `<space>` or nothing \: `<o-space>`.
* `<decimal-number><o-space><tex-unit><o-space>` \: `<dimen>`.
* `<control-sequence>` not listed in section~\ref[listcs] nor in configuration \: `<unknown-control-sequence>`.\r[unkncs]
* `=<o-space>` or `<o-space>` \: `<o-equal>`.
* `<unknown-control-sequence><o-equal><dimen>` \: should be completely ignored.\r[eqdim]
* `<unknown-control-sequence><o-equal><number>` \: should be completely ignored.
* `<unknown-control-sequence>=<o-space>{<balanced-text>}` \: should be completely ignored.
* `<unknown-control-sequence>[<balanced-text>]` \: should be completely ignored.\r[ibkt]
* `<unknown-control-sequence>` \: should be ignored.\r[ignore]
* `<control-sequence>`s are processed as described in section~\ref[listcs] or
  by a configuration of the cnv-program.
\enditems

\bigskip
\label[vtohmode]\caption/t
List of control sequences which switch from v-mode to h-mode.
\cskip
\begblock
`\indent`, `\noindent`, `\leavevmode`, `\hskip`, `\hfil`, `\hfill`, `\hss`,
`\`<space>, `\vrule`, `\caption`, `\bib`
\endblock

\bigskip
\label[htovmode]\caption/t
List of control sequences which switch from h-mode to v-mode.
\cskip
\begblock
`\par`, `\vskip`, `\vfil`, `\hrule`, `\bigskip`, `\medskip`, `\smallskip`,
`\chap`, `\sec`, `\secc`, `\secl`, `\end`, `\bye`, `\begitems`, `\begtt`,
`\begblock`, `\enditems`, `\endblock`, `\caption`, `\cskip`, `\bib`.
\endblock

\bigskip
\label[tex-units]\caption/t
List of \TeX/ units.
\cskip
\begblock
`pt`, `pc`, `bp`, `dd`, `cc`, `in`, `cm`, `mm`, `sp`, `em`, `ex`.
\endblock

\nonum\secc Examples

\begitems
* `\%` is `<control-sequence>` by rules \ref[scs], \ref[cs]. It does not start
  comment, because rule \ref[scs] has precedence before rule \ref[com].
* `\%<space>`: the `<space>` is kept, but `\foo<space>`: the space is removed
  by rule~\ref[csspace].
* `wordA<spaces><eol><spaces>wordB` is `wordA<space>wordB` by rules~\ref[bspace],
  \ref[eolrm], and~\ref[sspace].
* `\kern-3pt` should be ignored, because `\kern` is `<unknown-control-sequence>` and rule
  \ref[eqdim] is applied.
* `\vskip42mm` should finalize paragraph in h-mode by rule~\ref[htov] and then it
  is ignored by rule~\ref[eqdim] because `\vskip` is not listed in section~\ref[listcs].
* `\typosize[12/16]` is ignored by rule~\ref[ibkt].
* `\foo{text}` is `{text}` (i.e. `text` in group) by rules~\ref[ignore] and~\ref[group].
\enditems

\sec Scanning parameters

If a control sequence listed in rules above or in the section~\ref[listcs]
has a parameter, the parameter is scanned
as a string with interpreatation only those rules which are needed to
determine the boundary of the parameters. For example `\tit <title><eol>`
applies only rule~\ref[eol] during scanning the parameter, i.e.\ `<title>`
is a string delimetered by the end of line or the end of file.
Or `\fnote{<balanced-text>}` applies only rule~\ref[balt].

If the parameter is in the format `{<something>}` then the `<something>` is
always `<balanced-text>`. We don't specify the type `<balanced-text>`
explicitly here, so we refer `\fnote{<text>}`, for example.

The spaces before scanned parameter or before `{<text>}` are optional
and they are ignored. Spaces inside `{`...`}` are not ignored.

If the parameter is in the format `{<something>}` and the first non-space
character is not `{` then the parameter is this first non-space character or
a `<control-sequence>` if the first non-space character is~`\`. For example
`\fnote a` is equal to `\fnote{a}`. The difference from this rule is given
for `\input`, `\verbinput`,`\inspic` and `\inkinspic`.

If the parameter is scanned as a string already then
the all syntactical rules are applied when it is used. For example:
\begtt
\tit    This is   a title
\endtt
the parameter is scaned as `This is   a title` and the rule~\ref[spcs] is
applied when the prameter is used.


\sec Declaration and text parts of the document

A typical \OpTeX/ document has two parts. A declaration part, where
macros are defined by `\def` and friends, fonts and sizes are declared, etc.
This part should be ignored by cnv-programs.
The second part includes the document text with a markup using well-declared control
sequences. The cnv-program has to interpret the second part.

So, the cnv-program starts in declaration-skipping mode and it switches to
the text mode later.

When cnv-program is in declaration-skipping mode then all indented lines are
ignored. And lines which begins by `}` or by a <control-sequence> not listed
in table~\ref[textopen] are ignored too.

If the line begins by a character other than `}` or by a <control-sequence>
listed in table~\ref[textopen] then cnv-program switches to text mode. All
texts are interpreted from this line including this one.

User can say explicitly where the second part of the document starts by
`%%:text` given at beginning of a line. Moreover, if `%%:decl` is given at
beginning of a line, then all text between `%%:decl` and `%%:text` is
ignored, only other possible `<cnv-declarator>`s are processed here.
The declaration part and the text part of the document can be fully determined
by `%%:decl` and `%%:text`.

\bigskip
\label[textopen]\caption/t
List of control sequences which start the text mode.
\cskip
\begblock \raggedright
`\tit`, `\sec`, `\secc`, `\secl`, `\fnote`, `\mnote`, `\rm`, `\bf`, `\it`,
`\bi`, `\table`, `\inspic`, `\caption`, `\begitems`, `\begblock`, `\begtt`,
`\verbinput`, `\maketoc`, `\ii`, `\iid`, `\begmulti`, `\cite`, `\rcite`,
`\ecite`, `\bib`, `\usebib`, `\inkinspic`, `\frame`, `\rotbox`, `\inoval`,
`\incircle`, `\clipinoval`, `\clipincircle`, `\puttext`, `\putpic`,
`\address`, `\lorem`, `\lipsum`, `\TeX`, `\OpTeX`, `\LaTeX`.
\endblock


\sec[cnv-decl] The `%%:` declarators

The `%%:` declarators are ignored when the document is processed by \TeX/
but they can give instructions to cnv-programs. The `%%:` must be placed at
beginning of the line. The list of `%%:` declarators follows:

\begitems
* `%%:decl` -- the following text is ignored until `%%:text` occurs. Only
  other `%%:` declarators are interpreted.
* `%%:text` -- the following text must be interpreted in text mode.
* `%%:to <format> <config-file>` -- if the cnv-program converts to the
  <format> then it has to use the <config-file>. For example:
  \begtt
  %%:to html html-mydocument.cfg
  %%:to markdown markdown-mydocument.cfg
  %%:to latex preamble-mydocument.cfg
  \endtt
  The language of the config files are not a part of this standard, we
  suppose something to be natural for used cnv-program. The config file should
  give additional rules for interpreting control sequences not listed in the
  section~\ref[listcs] (see rule~\ref[unkncs]). For example a simple alternative
  of `\def` commands can be here. Users can declare more control sequences
  depending on the converted document and on the output format by the
  configuration files. For example, a special \LaTeX/ preamble should be declared
  here when conversion to \LaTeX/ is processed.
* `%%:app <application> <config-file>` -- behaves like `%%;to` but the
  cnv-program name instead output format is given here.
* `%%:do <format-or-app> <action>` -- does an `<action>` if `<format-or-app>`
  is output format or used cnv-program name. The `<action>` syntax depends
  on used cnv-program and it typicaly does a change in its configuration.
* `%%:skip <formats-or-apps>` -- ignores all following lines until another `%%:` occurs
  if the output format or application name is included in the `<formats-or-apps>`
  space-separated list. Example:
  \begtt
  %%:skip html markdown
  This text is not interpreted when Html or Markdown output is generated.
  %%:
  \endtt
  If the `<formats-or-apps>` is empty then the `%%:skip` is applied for
  each cnv-program and for each output.
* `%%:if <formats-or-apps>` -- processes following lines until another `%%:`
  only if the output format or application name is included in the
  `<formats-or-apps>` space-separated list. Other cnv-programs or otput
  formats not mentioned here are skipped. Note that \TeX/ processes such
  lines always. But you can use `\ignoreit{<text>}` which is processed as
  `{<text>}` by cnv-programs (see rule~\ref[ignore]) but it is ignored by \OpTeX.
  Example:
  \begtt
  %%:if html latex
  \ignoreit{\input{file.tex}}
  %%:
  \endtt
  The `file.tex` in this example is processed only if \LaTeX/ or Html output is generated.
* `%%:use` -- the next single line is fully interpreted unless cnv-program ignores
  declarations by `%%:decl` or because it is in declaration-skipping mode.
  Example:
  \begtt
  %%:use
  \verbchar` \picdir={img/}
  \endtt
  The example shows how cnv-program is able to read `\verbchar` or
  `\picdir` settings in declaration-skipping mode although these control
  sequences are not listed in table~\ref[textopen].
* `%%:quotes <qql> <qqr> <ql> <qr>` -- declares `<qql>` and `<qqr>`: left
  and right double quotation marks, `<ql>` and `<qr>`: left and right single
  quotation mark. They are used when `\"` or `\'` control sequences are
  processed. Default: unset. It emans that `\"` and `\'` are interpreted as
  unknown control sequences.
\enditems


\sec[listcs] List of known control sequences

The phrase \"should be" is used very often when the interpretation of
control sequences are declared here. It means that this is only a common
interpretation, but differeces are possible due to the type of the output
format and used cnv-program. For example, when we convert to \LaTeX\, then
`\-` and `\/` are not ignored but they are re-written without change to the
output of the \LaTeX/ source file.

\bigskip
\caption/t List of known control sequences alphabeticaly sorted.
\cskip
\begblock
\rightskip=10pt plus1fil \relax \printknowncs
\endblock


\secc Character-like control sequences

\begitems
* \.`\%`, \.`\$`, \.`\&`,\.`\#` respectively \: should be normal characters `%`, `$`, `&`, `#` respectively.
* \.`\bslash` \: normal character `\`.
* \.`\space`, `\<space>`, `\<eol>` \: space.
* `\,` \: should be small space or space.
* \.`\quad`, \.`\qquad` \: should be bigger space or more spaces.
* \.`\-`, \.`\/` \: should be ignored.
* \.`\"<text>"` or \.`\'<text>'` \: `<clqq><text><crqq>` or `<clq><text><crq>`,
  only if `%%:quotes` are set.
\enditems

\secc Input files

\begitems
* \.`\input {<file-name>}` or `\input <file-name><space>` should redirect the
  input to given file. At the end of input-ed file or at \.`\endinput` the
  reading of current file continues. The file is read from current
  directory, but the <file-name> shoud include the full path to the file
  or relative path starting from current directory. First, the file
  `<file-name>.tex` is tried to read and if it doesn't exist then
  the file `<file-name>` is read.
* \.`\picdir <o-equal>{<text>}` saves `<text>` to `<picdir-value>`. By
  default, `<picdir-value>` is empty.
* \.`\inspic {<file-name>}` or `\inspic <file-name><space>` should include the
  given picture from the `<picdir-value><file-name>`.
* \.`\inkinspic {<file-name>}` or `\inkinspic <file-name><space>` behaves like
  `\inspic`.
* \.`\verinput <ignore> (<lines>) <file-name><space>` should include the
  <file-name> (only given lines) as a verbatim text, i.\,e. without any
  syntactical interpretation.
* \.`\usebib/<letter> (<style>) <file-names>` should use files from
  `<file-names>` to generate the list of bib references. The `<file-names>`
  is comma separated list (the `.bib` extension must be appended to
  each such file name). Only cited bib records should be used in this
  bib-references, i.e. their label must be used in a `\cite[<labels>]`.
  What part of bib data are used in bib records depends on cnv-program and
  on its configuration. Maybe, simple cnv-programs should genereate nothing
  here.
\enditems

\secc Titles

\begitems
* \.`\tit <title><eof>` should be a title of the document.
* \.`\chap <title><eof>` or `\chap [<label>] <title><eof>` is the title of
  first level.
* \.`\sec <title><eof>` or `\sec [<label>] <title><eof>` is the title of
  second level.
* \.`\secc <title><eof>` or `\secc [<label>] <title><eof>` is the title of
  third level.
* \.`\secl<level> <title><eof>` is the title of given level.
\enditems

\secc Fonts

\.`\rm` selects upright normal font (it is selected by default), \.`\it` selects
italic, \.`\bf` selects upright bold font, \.`\bi` selects bold italic and
\.`\tt` selects monospaced font, \.`\em` select italic (if upright is current) or upright
(if italic is current). The font sizes or other font features are typically ignored
by cnv-programs. The actual font selection is closed at the end of current group.
The groups are given:
\begitems
* explicitly by `{` and `}` characters (which are not delimiters of
  parameters of known control sequences),
* implicitly: parameters of control sequences listed in table~\ref[groupcs]
  are processed in a group and blocks of text enclosed by
  `\begitems`...`\enditems`, `\begblock`...`\endblock`, `\begmulti`...`\endmulti`
  are processed in a group.
  Each item in `\table` is in a group.
\enditems

\label[groupcs]
\caption/t Parameters of following control sequences are processed in a group.
\cskip
\begblock
`\tit`, `\chap`, `\sec`, `\secc`, `\fnote`, `\mnote`, `\caption`.
\endblock

\secc Colors

\.`\Red`, \.`\Green`, \.`\Blue`, \.`\Cyan`, \.`\Magenta`, \.`\Yellow`, \.`\White`,
\.`\Black`, and \.`\Brown` should select given color of the font. The selection
is closed at the end of current group (like font selectors).

\secc Blockquotes

The blockquote\fnote
{The terminology is borrowed from Markdown.}
is opened by \.`\begblock` and closed by \.`\endblock`.
Blockquotes can contain multiple paragraphs and can contain nested
blockquotes.

\secc Lists

The list is opened by \.`\begitems` and closed by \.`\enditems`. The `*` starts
new item in this environment. Nested lists are allowed.

The type of items (ordered/unordered)
is given by \.`\style <character>`, see section 1.4.5 in the
\OpTeX/ documentation. Default type is unordered (bullets are used).


\secc Code blocks (verbatim texts)

Code blocks are inline verbatim or display verbatim.

\begitems
* \.`\begtt <ignored><eol><text>\endtt<ignored><eol>` processes `<text>` in
  \"display verbatim mode", i.\,e. there are no special characters, each character
  is processed without special interpretation, the <eol>s are end of lines.
  The text at the same line after `\begtt` and after `\endtt` (if any) is
  ignored.
* \.`\verbchar <character>` declares `<verbchar>`. By default, it is undeclared.\nl
  New `\verbchar <character>` rewrites previous setting. The setting is
  local in the group.
* Inline verbatim is enclosed in the pairs of `<verbchar>`s.
  The text between two verbchars is processed without
  special interpretation. Only possibly <eol>s are replaced by space.
  Example:
  \begtt
  %%:use
  \verbchar`
  Now `$this %text   ~\` is processed as inline verbatim.
  \endtt
  gives: Now `$this %text   ~\` is processed as inline verbatim.
* \.`\code{<text>}` processes `<text>` like inline verbatim, but
  all `\<character>` are processed as `<character>`, specially `\{` and `\}`
  are `{` and `}` but without taking them into `<balanced-text>` rule,
  `\\` is `\` but do not create a `<control-sequence>`, etc.
\enditems


\secc Links

\begitems
* \.`\url{<text>}` creates `<text>` as an external link which points to `<text>`.
  The `\<character>` is interpreted as `<character>` in `<text>` with one
  exception: `\|` is ignored.
* \.`\ulink[<url>]{<text>}` creates `<text>` as an external link which points
  to `<url>`. The `\<character>` is interpreted as `<character>` only in
  `<url>` parameter.
* \.`\label[<label>]` sets the `<label>` to the `<label-register>`. It is
  empty by default. Each occurence of `\chap`, `\sec`, `\secc`, `\caption`
  or `\eqmark` uses non-empty `<label-register>` and sets it empty again.
* \.`\ref[<label>]` should create an interlnal link to the place given by
  `\chap`, `\sec`, `\secc`, `\caption` or `\eqmark`,
  if `[<label>]` is used as the parameter of this control sequence
  else if `<label>` is equal to the used `<label-register>` here.
  The visual aspect of the link
  is not declared by OMLS because we don't suppose that the chaptes,
  sections, equations, etc.\ are automatially numbered by exactly the same way as in
  \OpTeX/. A recommedation should be: create simple sequence of numbers over
  all interlnal links.
* \.`\pgref[<label>]` should be replaced by `??` if cnv-program generates single-page
  output (like Html, Markdown). Unfortunatelly, we get the irrelevant phrases in the output:
  \"{\tt The problem is shown at the page ??}", but better solution
  probably does not exist.
* \.`\bib[<label>]` or `\bib[<label>]<o-space>=<o-space>{<ignored>}` should open the new bib
  record. More exactly, it closes previous paragraph (if h-mode is current)
  and opens new h-mode. Then prints an auto-generated number. Followng text
  is interpreted as a bib record until the h-mode ends.
* \.`\cite[<labels>]` should create an internal links to corresponding bib
  record generated by `\usebib` or by `\bib`. The `<labels>` is comma
  separated list of labels used in `.bib` files or in `\bib` commands to indicate
  the corresponding bib record. The labels should be replaced by auto-generated
  numbers used in bib records encloded by `[...]`. These numbers are
  internal links. If the cnv-program does not implement this complicated
  bib machinery then `\cite[<labels>]` should print only `[<labels>]`.
* \.`\maketoc` should create a list of titles from all `\chap`, `\sec` and `\secc`
  used in the document if they are not preceded by `\notoc`. All lines in
  this list should include internal links to the place where the corresponding title
  is used.
\enditems

\secc Tables

\begitems
* \.`\caption/<letter>` opens a caption. More exactly, if current mode is
  h-mode, then switch to v-mode first (i.e.\ close the current paragraph).
  Then switch from v-mode to h-mode and put a <caption-head>. The following
  text should be interpreted as the caption text until h-mode ends.
  If <letter> is `t` then <caption-head> is `Table` followed
  by an auto-generated number. If the <letter> is `f` then <caption-head> is
  `Figure` followed by an auto-generated number. The configuration of
  cnv-programs shoud allow different words than default `Table` or `Figure` (for
  example, if different language is used).
* \.`\table<ignored>{<declaration>}{<data>}` should create a table. The fidelity
  rate of created output depends heavily on the used cnv-program and the output
  format. We don't suppose that all aspects of \OpTeX/ tables are imeplemented.
  The following features are listed in their priority of implementation.
  \begitems \style c
  * Items in `<data>` are separated by `&`.
    The last item in each row is separated by end-row separator: \.`\cr`, \.`\crl`, \.`\crll`,
    \.`\crli`, \.`\crlli`, or \.`\crlp{<list>}`. If there are $n$ columns then we
    have $n-1$ `&` separators and one end-row separator.
    There should be optional end-row separator ad first item in `<data>` and
    it should be ignored. The `<data>` should end without end-seprator, it
    should be added here.
  * Spaces around `&` and before end-line separator are ignored.
  * \.`\noalign{<text>}` and \.`\tskip <dimen>` should be ignored.
  * Colum declarators in <data> should be interpreted: `l` (left aligned), `c` (center
    aligned), `r` (right aligned) or `p{<ignored>}` (paragraph-like item).
  * \.`\vspan<number>{<text>}` or `\vspan{<number>}{<text>}` in a item should
    be only `<text>`.
  * \.`\mspan<number>[<decl>]{<text>}` should create `<text>` as an item which
    spans over `<number>` columns.
  * Rules in the table should be interpreted, i.e. `|` in <declaration>
    should be not ignored and
    various end-row separators should be distinguished (see \OpTeX/ manual,
    section 1.4.6.
  * The aligning of `p{<p-data>}` columns should be interpreded by reading
    \.`\fL`, \.`\fR`, \.`\fC`, \.`\fS` and \.`\fX` control sequences in `<p-data>`.
    See \OpTeX/ documentation.
  \enditems
\enditems

\secc Footnotes, marginal notes

\begitems
* \.`\fnote{<text>}` should create a footnote as an auto-generated number.
  The `<text>` should be appended at the end of the document labeled by this
  number. The link to this appended text should be created. Another
  alternative (for Html output, for example): the auto-generated number
  riases an auto-popup `<text>`.
* \.`\mnote{<text>}` should be created as auto-popup `<text>` or the `<text>`
  is inserted at the margin.
\enditems



\sec[math] Math mode processing

... todo

\sec Notes on various conversions

... todo

\bye
